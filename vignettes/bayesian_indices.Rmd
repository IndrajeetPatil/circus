---
title: "Bayesian indices data"
output: 
  github_document:
    toc: true
    fig_width: 10.08
    fig_height: 6
  rmarkdown::html_vignette:
    toc: true
    fig_width: 10.08
    fig_height: 6
tags: [r, bayesian, posterior, test]
vignette: >
  \usepackage[utf8]{inputenc}
editor_options: 
  chunk_output_type: console
---

# Generate Data of Bayesian Indices

```{r eval=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(bayestestR)
library(rstanarm)
library(broom)

# options(mc.cores = parallel::detectCores())
set.seed(333)

generate_data <- function(sample_size, noise, correlation=1){
  data <- data.frame(x = scale(rnorm(sample_size, 0, 1)))
  if(correlation==1){
    data$y <- scale(data$x)
    data$y <- data$y + rnorm(sample_size, mean = 0, sd = noise)
  } else{
    data$y <- scale(rnorm(sample_size, 0, 1))
  }
  return(data)
}

df <- data.frame() # Uncomment this if you want to reset the data

for(noise in c(0.1, seq(2.5, 5, by=2.5))){
  for(sample_size in c(20, 40, 60)){
    print(paste0(noise, "-", sample_size))
    for(effect in c(0, 1)){
      for(prior in c(0, 1)){
        for(i in 1:1000){
          cat(".")
          data <- generate_data(sample_size, noise, effect)

          freq_model <- lm(y ~ x, data=data)
          summary(freq_model)
          beta <- broom::tidy(freq_model)[2, ]$estimate
          p_frequentist <- broom::tidy(freq_model)[2, ]$p.value

          out <- capture.output(bayes_model <- rstanarm::stan_glm(y ~ x,
                                                                  data=data,
                                                                  chains=2,
                                                                  prior=normal(location=prior)))
          posterior <- as.data.frame(bayes_model)$x

          median <- median(posterior)
          mean <- mean(posterior)
          map <- map_estimate(posterior)[1]

          p_direction <- p_direction(posterior)
          rope <- rope(posterior, bounds = c(-0.1, 0.1), CI=90)
          rope_full <- rope(posterior, bounds = c(-0.1, 0.1), CI=100)
          p_rope <- p_rope(posterior, bounds = c(-0.1, 0.1))
          p_map <- p_map(posterior)

          df <- rbind(df,
                       data.frame(effect=effect,
                                  noise=noise,
                                  sample_size=sample_size,
                                  prior=prior,
                                  prior_correct=abs(1-abs(effect-prior)),
                                  iteration=i,
                                  beta = beta,
                                  median = median,
                                  mean = mean,
                                  map = map,
                                  p_frequentist = p_frequentist,
                                  p_direction = p_direction,
                                  rope = rope,
                                  rope_full = rope_full,
                                  p_rope=p_rope,
                                  p_map = p_map))
        }
      }
    }
  }
  write.csv(df, "../data/bayes_indices.csv", row.names = FALSE)
}
```